<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">

	<title>Covid maker directory</title>

	<script src="https://cdn.jsdelivr.net/npm/vue@2.6.0"></script>
	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
	<script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
	<script defer src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment-with-locales.min.js"></script>

	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.0/css/bulma.min.css">

	<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<div id="app">
	<section class="section">
		<h1 class="title is-1">
			Covid maker local group list
		</h1>

		<div>
			Filter
			<ul>
				<li>
					<input id="validation" type="checkbox" v-model="filter.validation" />
					<label for="validation">Show validation & hospital</label>
				</li>
				<li>
					<label for="country">Country</label>
					<input id="country" type="input" v-model="filter.country" />
				</li>
			</ul>
		</div>

		<table class="table is-narrow is-striped is-bordered is-fullwidth is-hoverable">
			<thead>
			<tr>
				<th>Label</th>
				<th>Type</th>
				<th>Product</th>
				<th>Technology</th>
				<th v-if="filter.validation">Certifications</th>
				<th v-if="filter.validation">Validated</th>
				<th v-if="filter.validation">Accepted in some hospital</th>
				<th>Spoken language</th>
				<th>Country</th>
				<th>Area</th>
				<th>Sub area</th>
				<th>Sub sub area</th>
				<th>Product form request</th>
				<th>Supplier form</th>
				<th>Maker form</th>
				<th>Provided product for</th>
				<th>Last data update</th>
			</tr>
			</thead>
			<tbody>
			<tr v-if="rows.length == 0">
				<td colspan="17">
					No results
				</td>
			</tr>
			<tr v-for="row in rowsFiltered">
				<td>
					<a :href="row.website">
						{{ row.label }}
					</a>
				</td>
				<td>{{ row.type }}</td>
				<td>{{ row.product | joinArray }}</td>
				<td>{{ row.technology | joinArray }}</td>
				<th v-if="filter.validation">{{ row.certifications | joinArray }}</td>
				<th v-if="filter.validation">{{ row.validated | joinArray }}</td>
				<th v-if="filter.validation">{{ row.accepted_hospital | joinArray }}</td>
				<td>{{ row.language | joinArray }}</td>
				<td>{{ row.countries | joinArray }}</td>
				<td>{{ (row.area ? row.area : '-') | joinArray }}</td>
				<td>{{ (row['sub-area'] ? row['sub-area'] : '-') | joinArray }}</td>
				<td>{{ (row['sub-sub-area'] ? row['sub-sub-area'] : '-') | joinArray }}</td>
				<td>
					<a :href="row.product_request_form">
						Request product
					</a>
				</td>
				<td>
					<a :href="row.supplier_form">
						Provide supply
					</a>
				</td>
				<td>
					<a :href="row.maker_form">
						Become maker
					</a>
				</td>
				<td>{{ row.product_for }}</td>
				<td>{{ row.last_update | formatDate }}</td>
			</tr>
			</tbody>
		</table>
	</section>
</div>


<script>

	axios.get('/data/data.json')
	     .then(function (response) {
		     app.rows = response.data;
	     })
	     .catch(function (error) {
		     // handle error
		     alert('Error on data loading: ' + error);
	     })
	     .then(function (response) {
		     app.loader = false;
	     });

	Vue.filter('joinArray', function (value) {
		if (Array.isArray(value)) {
			return value.join(', ');
		}

		return value;
	});

	Vue.filter('formatDate', function (value) {
		return moment(value).format('DD/MM/YYYY h:mm');
	});

	var app = new Vue({
		el: '#app',
		computed: {
			rowsFiltered: function () {
				if (this.filter.country.length > 0)
				{
					return this.rows.filter(function (row, index) {
						return row.countries.includes(app.filter.country);
					})
				}

				return this.rows;
			}
		},
		data: {
			loader: true,
			message: 'Hello Vue !',
			rows: [],
			filter: {
				validation: false,
				country: '',
			}
		}
	})
</script>
</body>
</html>
